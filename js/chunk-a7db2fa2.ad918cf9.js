(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a7db2fa2"],{"0248":function(e,t,n){},"50f8":function(e,t,n){"use strict";var r=n("2b0e");t["a"]=new r["a"]},"524b":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("van-nav-bar",{staticClass:"page-navbar",attrs:{title:"个人信息","left-arrow":""},on:{"click-left":function(t){return e.$router.replace("/my")}}}),n("van-cell-group",[n("van-cell",{attrs:{title:"头像","is-link":"",center:""},on:{click:e.onShowFile}},[n("van-image",{staticClass:"avatar",attrs:{round:"",fit:"cover",src:e.user.photo}})],1),n("input",{ref:"file",attrs:{type:"file",hidden:"",accept:"image/*"},on:{change:e.onFileChange}}),n("van-cell",{attrs:{title:"昵称",value:e.user.name,"is-link":""},on:{click:e.onEditNameShow}}),n("van-cell",{attrs:{title:"性别",value:0===e.user.gender?"男":"女","is-link":""},on:{click:function(t){e.isEditGenerShow=!0}}}),n("van-cell",{attrs:{title:"生日",value:e.user.birthday,"is-link":""},on:{click:function(t){e.isEditBirthdayShow=!0}}})],1),n("van-popup",{staticClass:"intro-popup",staticStyle:{height:"100%"},attrs:{position:"bottom","get-container":"body"},on:{opened:function(t){return e.$refs.name.focus()}},model:{value:e.isEditNameShow,callback:function(t){e.isEditNameShow=t},expression:"isEditNameShow"}},[n("van-nav-bar",{attrs:{title:"昵称","left-text":"取消","right-text":"完成"},on:{"click-left":function(t){e.isEditNameShow=!1},"click-right":e.onNameConfirm}}),n("div",{staticClass:"intro-field-wrap"},[n("van-field",{ref:"name",attrs:{rows:"2",autosize:"",type:"textarea",maxlength:"7",placeholder:"请输入昵称","show-word-limit":"",id:"name"},model:{value:e.inputName,callback:function(t){e.inputName=t},expression:"inputName"}})],1)],1),n("van-popup",{attrs:{position:"bottom","get-container":"body"},model:{value:e.isEditGenerShow,callback:function(t){e.isEditGenerShow=t},expression:"isEditGenerShow"}},[n("van-picker",{attrs:{"show-toolbar":"",title:"性别",columns:e.columns,"default-index":e.user.gender},on:{cancel:function(t){e.isEditGenerShow=!1},change:e.onPickerChange,confirm:function(t){return e.saveProfile("gender",e.selectedGender)}}})],1),n("van-popup",{attrs:{position:"bottom"},model:{value:e.isEditBirthdayShow,callback:function(t){e.isEditBirthdayShow=t},expression:"isEditBirthdayShow"}},[n("van-datetime-picker",{attrs:{type:"date","min-date":e.minDate,"confirm-button-text":"完成"},on:{confirm:e.onBirthdayConfirm,cancel:function(t){e.isEditBirthdayShow=!1}},model:{value:e.currentDate,callback:function(t){e.currentDate=t},expression:"currentDate"}})],1),n("van-popup",{staticStyle:{height:"100%","background-color":"#000"},attrs:{position:"bottom"},model:{value:e.isPreviewPhotoShow,callback:function(t){e.isPreviewPhotoShow=t},expression:"isPreviewPhotoShow"}},[e.isPreviewPhotoShow?n("img-cropper",{ref:"img-cropper",attrs:{src:e.previewImage}}):e._e(),n("div",{staticClass:"crop-bottom"},[n("span",{on:{click:function(t){e.isPreviewPhotoShow=!1}}},[e._v("取消")]),n("span",{on:{click:e.onPhotoConfirm}},[e._v("完成")])])],1)],1)},i=[],a=(n("b0c0"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),n("ade3")),o=(n("96cf"),n("1da1")),s=n("c24f"),c=n("5a0c"),u=n.n(c),h=n("50f8"),l=n("d62c"),p={name:"UserProfile",components:{ImgCropper:l["a"]},data:function(){return{user:{},isEditNameShow:!1,isNameShow:!1,inputName:"",isEditGenerShow:!1,actions:[{name:"男",value:0},{name:"女",value:1}],isEditBirthdayShow:!1,currentDate:new Date,minDate:new Date(1970,1,1),isPreviewPhotoShow:!1,previewImages:[],previewImage:"",columns:["男","女"],selectedGender:0}},computed:{file:function(){return this.$refs.file}},created:function(){this.loadUserProfile()},methods:{onPickerChange:function(e,t,n){this.selectedGender=n},loadUserProfile:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["d"])();case 2:t=e.sent,n=t.data,this.user=n.data,this.currentDate=new Date(this.user.birthday);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onEditNameShow:function(){this.inputName=this.user.name,this.isEditNameShow=!0},onShowFile:function(){this.file.click()},onFileChange:function(){var e=URL.createObjectURL(this.file.files[0]);this.previewImages=[],this.previewImages.push(e),this.previewImage=e,this.isPreviewPhotoShow=!0,this.file.value=""},saveProfile:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$toast.loading({duration:0,forbidClick:!0,message:"保存中..."}),e.prev=1,e.next=4,Object(s["l"])(Object(a["a"])({},t,n));case 4:this.$toast.success("保存成功"),this.user[t]=n,h["a"].$emit("user-update"),this.isEditGenerShow=!1,e.next=14;break;case 10:return e.prev=10,e.t0=e["catch"](1),this.$toast.success("保存失败"),e.abrupt("return",Promise.reject(e.t0));case 14:case"end":return e.stop()}}),e,this,[[1,10]])})));function t(t,n){return e.apply(this,arguments)}return t}(),onNameConfirm:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.saveProfile("name",this.inputName);case 3:this.user.name=this.inputName,this.isEditNameShow=!1,e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),t=e.t0.response,400===t.status?this.$toast.fail("昵称必须在1-7个字符之间"):409===t.status&&this.$toast.fail("昵称已存在");case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}(),onGenerSelect:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.saveProfile("gender",t.value);case 2:this.user.gender=t.value,this.isEditGenerShow=!1;case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),onBirthdayConfirm:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=u()(t).format("YYYY-MM-DD"),e.next=3,this.saveProfile("birthday",n);case 3:this.user.birthday=n,this.isEditBirthdayShow=!1;case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),onUpdatePhoto:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$toast.loading({duration:0,forbidClick:!0,message:"保存中..."}),e.prev=1,t=new FormData,n=this.file.files[0],t.append("photo",n),e.next=7,Object(s["k"])(t);case 7:this.user.photo=URL.createObjectURL(n),this.isPreviewPhotoShow=!1,this.$toast.success("保存成功"),h["a"].$emit("user-update"),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](1),this.$toast.success("保存失败");case 16:case"end":return e.stop()}}),e,this,[[1,13]])})));function t(){return e.apply(this,arguments)}return t}(),onPhotoConfirm:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$toast.loading({duration:0,forbidClick:!0,message:"保存中..."}),e.prev=1,t=new FormData,e.next=5,this.$refs["img-cropper"].getCroppedBlob();case 5:return n=e.sent,console.log(n),t.append("photo",n),e.next=10,Object(s["k"])(t);case 10:this.user.photo=URL.createObjectURL(n),this.isPreviewPhotoShow=!1,this.$toast.success("保存成功"),h["a"].$emit("user-update"),e.next=19;break;case 16:e.prev=16,e.t0=e["catch"](1),this.$toast.success("保存失败");case 19:case"end":return e.stop()}}),e,this,[[1,16]])})));function t(){return e.apply(this,arguments)}return t}()}},d=p,f=(n("62f3"),n("2877")),m=Object(f["a"])(d,r,i,!1,null,"7491f446",null);t["default"]=m.exports},"62f3":function(e,t,n){"use strict";var r=n("0248"),i=n.n(r);i.a},c24f:function(e,t,n){"use strict";n.d(t,"h",(function(){return i})),n.d(t,"g",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"j",(function(){return s})),n.d(t,"e",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"k",(function(){return h})),n.d(t,"l",(function(){return l})),n.d(t,"i",(function(){return p})),n.d(t,"f",(function(){return d})),n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return m}));n("d3b7"),n("25f0");var r=n("b775");function i(e){return Object(r["a"])({method:"POST",url:"/app/v1_0/authorizations",data:e})}function a(){return Object(r["a"])({method:"GET",url:"/app/v1_0/user/channels"})}function o(e){return Object(r["a"])({method:"POST",url:"/app/v1_0/user/followings",data:{target:e}})}function s(e){return Object(r["a"])({method:"DELETE",url:"/app/v1_0/user/followings/".concat(e)})}function c(){return Object(r["a"])({method:"GET",url:"/app/v1_0/user"})}function u(e){return Object(r["a"])({method:"GET",url:"/app/v1_0/user/profile"})}function h(e){return Object(r["a"])({method:"PATCH",url:"/app/v1_0/user/photo",data:e})}function l(e){return Object(r["a"])({method:"PATCH",url:"/app/v1_0/user/profile",data:e})}function p(e){return Object(r["a"])({method:"GET",url:"/app/v1_0/sms/codes/".concat(e)})}function d(e){return Object(r["a"])({method:"GET",url:"/app/v1_0/users/".concat(e)})}function f(e,t){return Object(r["a"])({method:"GET",url:"/app/v1_0/user/followings",params:t,data:{target:e.toString()}})}function m(e,t){return Object(r["a"])({method:"GET",url:"/app/v1_0/user/followers",params:t,data:{target:e.toString()}})}}}]);
//# sourceMappingURL=chunk-a7db2fa2.ad918cf9.js.map